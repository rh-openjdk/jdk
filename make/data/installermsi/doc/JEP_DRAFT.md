JEP draft: MSI Installer for Windows
====================================
 
Summary
-------

Support packaging OpenJDK as a Windows Installer (MSI) with "make installer-msi" leveraging the jpackage tool.
 
Goals
-----
 
 - allow to build a fully functional (albeit basic) installer from upstream OpenJDK repository without requiring
 any additional scripts and resources (except MSI build tools that need to be provided)
 - allow to create an installer description (for MSI build tools) in a form that it can be used by
 OpenJDK vendors to extend vanilla installer with additional selectable features; provide documentation
 and extension examples
 
Non-goals
---------
 
 - no additional files or major components (like auto-updater) besides "make images" files
 - no installer customization with autoconf flags
 - no support for other installation formats/tools (NSIS, Inno, install4j, IzPack etc)
 - no support for cross-building from other OS - installer can only be built on Windows
 - no support for Windows ARM64 - only x86_64 arch is supported in initial implementation
 - no unification with Linux or Mac packaging support in OpenJDK
 
Motivation
----------
 
 - MSI installers built with WiX toolset are a de-facto standard on Windows
 - casual OpenJDK builders may want to build a ready-to use installer
 - OpenJDK vendors may want to have a "base layer" ("make images" output) for their customized installers
 
Description
-----------
 
Installer is created by "make installer-msi" target that runs jpackage tool on "make images" output.
jpackage collects the list of files from filesystem, generates installer description files
and invokes MSI tools from WiX toolset to produce the resulting installer.

Additional target "make installer-msi-xml" is implemented to transform a set of XML and XML-like files, generated by jpackage,
into a single XML file that can be used by OpenJDK vendors to build their customized installers.

Default visual resources (banners, logos) are based on official OpenJDK Duke picture.

System integration
------------------

Vanilla installer provides the ability ro run ".jar" files from Windows Explorer either with a double-click or
from a context menu. This is implemented by setting a number of Windows Registry keys.

Environment variables "PATH" and "JAVA_HOME" also can be set by installer.
 
Extending approaches
--------------------

XML descriptor can be transformed by OpenJDK vendors to change the labels or
include additional files and selectable features.
 
Implementation includes documented extension examples in Java (using DOM or using JAXB) and in JavaScript.

Relation to JDK Packaging Guidelines
------------------------------------

JEP draft JDK Packaging Guidelines (JDK-8278252) specify some details about the packaging of a JDK
on Windows. Installer implementation follows its guidelines on vendor directory naming ("OpenJDK" directory in vanilla)
and on the use of "VERSION_FEATURE" in JDK directory naming. It also intend to follow other relevant guidelines
(for example: the set of Windows Registry keys) that can be added to this JEP draft in future.
 
Testing
-------
 
While vanilla installer is not built by default, it must be always buildable.

Set of JTreg tests is included with the implementation, these tests cover the following areas:
 
 - vanilla installer (created with "make installer-msi"): installation/uninstallation with different
 sets of selected features, comparison of a set of installed files with a "make images" output
 - extended installers (created using extension examples): extended installers are created and then
 installed/uninstalled during the test
 
Dependencies
------------
 
To build the installer it is necessary to install a third-party WiX toolset.
This toolset is a widely used open-source project that is governed by .NET Foundation.
